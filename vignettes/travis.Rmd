---
title: "Working with Travis in R"
author: "Patrick Schratz, Kirill Müller"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Kirill Müller}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

The goal of the _travis_ pkg is to simplify the setup of continuous integration with [Travis CI](https://travis-ci.org/).
The package supports both Travis CI endpoints `.org` and `.com`.
Besides simplifying the deployment setup for Travis by creating a SSH key pair, the _travis_ package provides a command-line way in R to execute tasks which are usually done in the browser (build checking, cache deletion, build restarts, etc.).

To learn more about Travis CI in general, read [this blog post](http://mahugh.com/2016/09/02/travis-ci-for-test-automation/) and the [Getting Started](https://ropenscilabs/tic/articles/tic.html#prerequisites) vignette of the _tic_ package.


_travis_ works best when combined with the [gh](https://github.com/r-lib/gh), [usethis](https://github.com/r-lib/usethis) and the [tic](https://github.com/ropenscilabs/tic) package. 
Here is a workflow which creates a repo on Github and activates it on Travis CI.

## Authentication

The first time any function is called, it will check for the existence of a Travis API key (for the respective endpoint).
This is a one-time procedure and needs to be done for each endpoint `.org` and `.com`.
The API key will be stored locally in `~/.travis/config.yml`.

In addition, _travis_ scrapes information about the current repository from Github.
To be able to do this, a `GITHUB_TOKEN` is needed.
You can create one using `usethis::browse_github_token()` if you haven't done so yet.

## Workflow example

1. Create a repository on GitHub (if it's not there yet)

    ```r
    gh::gh("POST /user/repos", name = "my-new-repo-for-gh-testing")
    ```

1. Show the GitHub repository name

    ```r
    travis::enable()
    ```

1. Enabled deployment for this repository

   ```r
   travis::use_travis_deploy()
   ```

1. Browse the repo on Travis

    ```r
    usethis::browse_travis()
    ```

## Relation to *tic* and *usethis* 

See the ["tic, travis and usethis - an overview" vignette](https://ropenscilabs.github.io/tic/articles/tic-usethis-travis.html) from the _tic_ package for more information.
